# å®Ÿè£…è¨ˆç”»æ›¸: LLM API è¨­å®šç”»é¢

## æ¦‚è¦

| é …ç›®       | å†…å®¹                                                           |
| :--------- | :------------------------------------------------------------- |
| **æ©Ÿèƒ½å** | LLM API è¨­å®šç”»é¢                                               |
| **ç›®çš„**   | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªèº«ã® LLM API ã‚­ãƒ¼ã‚’è¨­å®šã—ã€AI æ©Ÿèƒ½ã‚’åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ |
| **å„ªå…ˆåº¦** | ğŸ”´ å¿…é ˆï¼ˆPhase 2 ã®å‰ææ¡ä»¶ï¼‰                                  |
| **ä¾å­˜**   | ãªã—                                                           |

---

## æ©Ÿèƒ½è¦ä»¶

### å¯¾å¿œã™ã‚‹ LLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

| ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼  | API ã‚­ãƒ¼å½¢å¼ | å¯¾å¿œãƒ¢ãƒ‡ãƒ«ä¾‹                       | å„ªå…ˆåº¦  |
| :------------ | :----------- | :--------------------------------- | :------ |
| **OpenAI**    | `sk-...`     | gpt-4o, gpt-4o-mini, gpt-3.5-turbo | ğŸ”´ å¿…é ˆ |
| **Anthropic** | `sk-ant-...` | claude-3-5-sonnet, claude-3-haiku  | ğŸ”´ å¿…é ˆ |
| **Google**    | `AIza...`    | gemini-2.0-flash, gemini-1.5-pro   | ğŸŸ¡ æ¨å¥¨ |

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¨­å®šç”»é¢ã‹ã‚‰ LLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’é¸æŠã™ã‚‹
2. API ã‚­ãƒ¼ã‚’å…¥åŠ›ãƒ»ä¿å­˜ã™ã‚‹
3. ä¿å­˜ã•ã‚ŒãŸ API ã‚­ãƒ¼ã¯å®‰å…¨ã«ä¿ç®¡ã•ã‚Œã‚‹
4. æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ API ã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèªã§ãã‚‹
5. ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã§ãã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## UI è¨­è¨ˆ

### è¨­å®šç”»é¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

- **ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼** â†’ è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ï¼ˆâš™ï¸ï¼‰â†’ ã€ŒAI è¨­å®šã€ã‚¿ãƒ–
- ã¾ãŸã¯ **URL**: `/settings/ai`

### ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† è¨­å®š                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ¤– AI è¨­å®š                                                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼                                         â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ â—‰ OpenAI    â—‹ Anthropic    â—‹ Google            â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ API ã‚­ãƒ¼                                            â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ sk-â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢            ğŸ”‘ â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ ãƒ¢ãƒ‡ãƒ«                                              â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ gpt-4o-mini                                  â–¼ â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ [æ¥ç¶šãƒ†ã‚¹ãƒˆ]                     [ä¿å­˜]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¡ API ã‚­ãƒ¼ã®å–å¾—æ–¹æ³•                                      â”‚
â”‚  â€¢ OpenAI: https://platform.openai.com/api-keys            â”‚
â”‚  â€¢ Anthropic: https://console.anthropic.com/settings/keys  â”‚
â”‚  â€¢ Google: https://aistudio.google.com/app/apikey          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“è¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```typescript
// types/ai.ts
export interface AISettings {
  provider: "openai" | "anthropic" | "google";
  apiKey: string;
  model: string;
  isConfigured: boolean;
}

export interface AIProvider {
  id: string;
  name: string;
  models: string[];
  apiKeyPrefix: string;
  apiKeyHelpUrl: string;
}

export const AI_PROVIDERS: AIProvider[] = [
  {
    id: "openai",
    name: "OpenAI",
    models: ["gpt-4o", "gpt-4o-mini", "gpt-3.5-turbo"],
    apiKeyPrefix: "sk-",
    apiKeyHelpUrl: "https://platform.openai.com/api-keys",
  },
  {
    id: "anthropic",
    name: "Anthropic",
    models: ["claude-3-5-sonnet-20241022", "claude-3-haiku-20240307"],
    apiKeyPrefix: "sk-ant-",
    apiKeyHelpUrl: "https://console.anthropic.com/settings/keys",
  },
  {
    id: "google",
    name: "Google",
    models: ["gemini-2.0-flash-exp", "gemini-1.5-pro"],
    apiKeyPrefix: "AIza",
    apiKeyHelpUrl: "https://aistudio.google.com/app/apikey",
  },
];
```

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

| ç’°å¢ƒ    | ä¿å­˜å…ˆ                          | æš—å·åŒ–        |
| :------ | :------------------------------ | :------------ |
| Web App | `localStorage` (æš—å·åŒ–)         | AES-256-GCM   |
| Tauri   | Tauri Store Plugin + Stronghold | OS ã‚­ãƒ¼ã‚¹ãƒˆã‚¢ |

```typescript
// lib/aiSettings.ts
const STORAGE_KEY = "zedi-ai-settings";

export function saveAISettings(settings: AISettings): void {
  const encrypted = encrypt(JSON.stringify(settings));
  localStorage.setItem(STORAGE_KEY, encrypted);
}

export function loadAISettings(): AISettings | null {
  const encrypted = localStorage.getItem(STORAGE_KEY);
  if (!encrypted) return null;
  return JSON.parse(decrypt(encrypted));
}
```

### API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```typescript
// lib/aiClient.ts
import OpenAI from "openai";
import Anthropic from "@anthropic-ai/sdk";
import { GoogleGenerativeAI } from "@google/generative-ai";

export function createAIClient(settings: AISettings) {
  switch (settings.provider) {
    case "openai":
      return new OpenAI({
        apiKey: settings.apiKey,
        dangerouslyAllowBrowser: true, // Web App ç”¨
      });
    case "anthropic":
      return new Anthropic({ apiKey: settings.apiKey });
    case "google":
      return new GoogleGenerativeAI(settings.apiKey);
  }
}

export async function testConnection(settings: AISettings): Promise<boolean> {
  try {
    const client = createAIClient(settings);
    // æœ€å°é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ¥ç¶šãƒ†ã‚¹ãƒˆ
    // ...
    return true;
  } catch {
    return false;
  }
}
```

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ Settings.tsx              # è¨­å®šãƒšãƒ¼ã‚¸ï¼ˆæ–°è¦ï¼‰
â”œâ”€â”€ components/
â”‚   â””â”€â”€ settings/
â”‚       â”œâ”€â”€ AISettingsForm.tsx    # AIè¨­å®šãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæ–°è¦ï¼‰
â”‚       â””â”€â”€ ProviderSelector.tsx  # ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é¸æŠï¼ˆæ–°è¦ï¼‰
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ aiSettings.ts             # è¨­å®šã®ä¿å­˜/èª­ã¿è¾¼ã¿ï¼ˆæ–°è¦ï¼‰
â”‚   â”œâ”€â”€ aiClient.ts               # AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆï¼ˆæ–°è¦ï¼‰
â”‚   â””â”€â”€ encryption.ts             # æš—å·åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆæ–°è¦ï¼‰
â”œâ”€â”€ types/
â”‚   â””â”€â”€ ai.ts                     # AIé–¢é€£ã®å‹å®šç¾©ï¼ˆæ–°è¦ï¼‰
â””â”€â”€ hooks/
    â””â”€â”€ useAISettings.ts          # AIè¨­å®šãƒ•ãƒƒã‚¯ï¼ˆæ–°è¦ï¼‰
```

---

## å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

| Step | å†…å®¹                                    | è¦‹ç©ã‚‚ã‚Š |
| :--- | :-------------------------------------- | :------- |
| 1    | å‹å®šç¾©ã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±ã®å®šç¾©          | 30 åˆ†    |
| 2    | è¨­å®šã®ä¿å­˜/èª­ã¿è¾¼ã¿æ©Ÿèƒ½ï¼ˆlocalStorageï¼‰ | 1 æ™‚é–“   |
| 3    | AI è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ           | 2 æ™‚é–“   |
| 4    | è¨­å®šãƒšãƒ¼ã‚¸ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ             | 30 åˆ†    |
| 5    | æ¥ç¶šãƒ†ã‚¹ãƒˆæ©Ÿèƒ½                          | 1 æ™‚é–“   |
| 6    | ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨­å®šã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ               | 30 åˆ†    |
| 7    | ãƒ†ã‚¹ãƒˆã¨ãƒã‚°ä¿®æ­£                        | 1 æ™‚é–“   |

**åˆè¨ˆè¦‹ç©ã‚‚ã‚Š: ç´„ 6.5 æ™‚é–“**

---

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
bun add openai @anthropic-ai/sdk @google/generative-ai
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **API ã‚­ãƒ¼ã®ãƒã‚¹ã‚¯è¡¨ç¤º**: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ `type="password"` ã‚’ä½¿ç”¨
2. **ãƒ­ãƒ¼ã‚«ãƒ«æš—å·åŒ–**: Web App ã§ã¯ AES-256-GCM ã§æš—å·åŒ–ã—ã¦ä¿å­˜
3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§é€ä¿¡ã—ãªã„**: API ã‚­ãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã€ç›´æ¥å„ API ã«é€ä¿¡
4. **ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³**: è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã§ãã‚‹æ©Ÿèƒ½ã‚’æä¾›

---

## ãƒ†ã‚¹ãƒˆé …ç›®

- [ ] API ã‚­ãƒ¼ã®ä¿å­˜/èª­ã¿è¾¼ã¿ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®æ¥ç¶šãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹
- [ ] ç„¡åŠ¹ãª API ã‚­ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] è¨­å®šãŒæ°¸ç¶šåŒ–ã•ã‚Œã‚‹ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ç¶­æŒï¼‰
- [ ] API ã‚­ãƒ¼ãŒãƒã‚¹ã‚¯è¡¨ç¤ºã•ã‚Œã‚‹

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [PRD: 2.5 AI æ©Ÿèƒ½ (Structural Intelligence)](../PRD.md#25-ai-æ©Ÿèƒ½-structural-intelligence---byok-bring-your-own-key)
