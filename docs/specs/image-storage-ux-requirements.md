# 画像保存UX要件定義書

## 概要

本ドキュメントは、Zediにおける「画像挿入・保存体験」を最短で使える形に整えるための要件定義である。  
前提として、Zedi本体は画像を保存せず、ユーザー自身のストレージに保存された画像URLのみを保持する。

## 目的

- 画像挿入の流れを止めず、メモ作成の集中を維持する
- 初回利用時の設定負担を最小化し、最短で使える
- 保存先が常に分かり、安心して使える

## スコープ

### 対象

- 画像ストレージ設定画面
- エディタ内の画像挿入フロー（選択・ドロップ・ペースト）
- アップロード進捗、エラーハンドリング、再試行
- 画像削除時の挙動（メモ内削除 / ストレージ削除）

### 非対象（現時点）

- 画像の高度編集（トリミング、回転、フィルター）
- 画像ギャラリー/ライブラリ
- アプリ側での画像ホスティング

## UX原則

- **止めない**: 画像挿入時に設定不足で止めず、最短導線を提示する
- **見える化**: どこに保存されるかを常時見える状態にする
- **局所対応**: エラーや進捗は画像ブロック単位で表現する

## ユーザーフロー

### 1. 初回挿入（未設定）

1. ユーザーが画像挿入（ドロップ/ペースト/選択）
2. ストレージ未設定を検知
3. 画面内モーダルで「今すぐ設定」を提示
4. 設定完了後、元のページへ復帰して再挿入可能

### 2. 通常挿入（設定済み）

1. 画像を挿入
2. カーソル位置に仮プレースホルダーを表示
3. アップロード完了後、実画像に置換

## 機能要件

### 1. ストレージ設定

- ユーザーは以下のプロバイダーから選択できること
  - Gyazo
  - Cloudflare R2
  - GitHub
  - Google Drive
- 各プロバイダーには「難易度」「無料枠」を明示すること
- セットアップガイドへのリンクを提供すること
- 接続テストを実行できること
- 保存後は、元のページに自動復帰できること（`returnTo`）

### 2. 画像挿入手段

- 以下の操作をサポートすること
  - エディタ内の選択メニューから挿入
  - ドラッグ&ドロップ
  - クリップボードからのペースト
  - ファイル選択
- 複数画像の同時挿入に対応すること

### 3. アップロードUX

- 画像挿入位置にプレビューを表示すること
- アップロード進捗を表示すること
- アップロード失敗時は該当ブロックにエラーを表示すること
- 再試行・削除の操作を提供すること

### 4. 保存先の見える化

- エディタ内に「現在の保存先」と接続状態を表示すること
- 画像ブロックから保存先URLを確認/コピーできること

### 5. 画像削除の区別

- メモから削除（URL削除）
- ストレージから削除（APIによる削除）
- 上記2つを明確に分けて選択できること

## 非機能要件

### セキュリティ

- 認証情報はローカルに暗号化保存すること
- Zediのサーバーには認証情報を送信しないこと
- 最小権限スコープを使用すること

### パフォーマンス

- アップロードは並列に処理できること
- アップロード中でも編集操作を阻害しないこと

## エラーハンドリング

- ストレージ未設定: 設定画面への導線を提示
- 認証失敗: 再認証または設定見直しを促す
- ネットワーク失敗: 再試行導線を提示
- 画像読み込み失敗: プレースホルダー表示

## 受け入れ基準（Acceptance Criteria）

- 画像挿入時に未設定なら、設定導線が提示される
- 設定後は元のページに戻り、再挿入ができる
- アップロード中の画像はプレースホルダーで表示される
- 失敗した画像だけを再試行できる
- 保存先と接続状態がエディタ内で確認できる
- 画像削除は「メモから削除」と「ストレージから削除」を区別できる

## 実装メモ（既存の実装状況）

- `src/components/settings/StorageSettingsForm.tsx` に設定UIが存在
- `src/hooks/useImageUpload.ts` にアップロード処理が存在
- `src/components/editor/TiptapEditor.tsx` に画像挿入フローが存在

## 未確定事項（Open Questions）

- 画像サイズの上限とデフォルト値
- 画像の自動リサイズ/変換の要否
- オフライン時の一時保存戦略
